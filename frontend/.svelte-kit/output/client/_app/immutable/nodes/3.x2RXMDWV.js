import"../chunks/Bzak7iHL.js";import"../chunks/BZvt_gsx.js";import{o as ie,a as le}from"../chunks/Cisc_5tI.js";import{o as ee,z as oe,D as W,v as D,Y as ve,A as ue,g as y,Z as fe,B as de,H as ce,C as Q,F as z,w as B,_ as _e,$ as pe,q as X,y as me,j as he,a0 as ge,m as P,a1 as j,a2 as ae,a3 as be,a4 as xe,k as re,p as ye,a5 as Ee,a6 as we,a7 as G,l as te,a8 as Te,a9 as Se,aa as Ae,ab as Ce,ac as Ie,L as Ne,G as Y,P as O,N as q,I as F,O as Re,J as R,s as k,K as N}from"../chunks/BvAXCPpv.js";import{d as $e,s as J}from"../chunks/C5-ZfVxS.js";import{i as K}from"../chunks/Hk8OhlQV.js";import{i as Me}from"../chunks/Cx7c0gRy.js";import{s as De,a as Oe}from"../chunks/DMENymi9.js";import{s as ke}from"../chunks/9XIqwSww.js";function He(r,a){return a}function Le(r,a,e){for(var n=r.items,f=[],v=a.length,u=0;u<v;u++)Se(a[u].e,f,!0);var m=v>0&&f.length===0&&e!==null;if(m){var g=e.parentNode;Ae(g),g.append(e),n.clear(),C(r,a[0].prev,a[v-1].next)}Ce(f,()=>{for(var _=0;_<v;_++){var x=a[_];m||(n.delete(x.k),C(r,x.prev,x.next)),te(x.e,!m)}})}function Be(r,a,e,n,f,v=null){var u=r,m={flags:a,items:new Map,first:null};{var g=r;u=D?W(ve(g)):g.appendChild(ee())}D&&ue();var _=null,x=!1,T=new Map,s=fe(()=>{var l=e();return be(l)?l:l==null?[]:ae(l)}),c,i;function o(){Fe(i,c,m,T,u,f,a,n,e),v!==null&&(c.length===0?_?re(_):_=X(()=>v(u)):_!==null&&ye(_,()=>{_=null}))}oe(()=>{i??(i=Ie),c=y(s);var l=c.length;if(x&&l===0)return;x=l===0;let A=!1;if(D){var E=de(u)===ce;E!==(l===0)&&(u=Q(),W(u),z(!1),A=!0)}if(D){for(var d=null,h,t=0;t<l;t++){if(B.nodeType===_e&&B.data===pe){u=B,A=!0,z(!1);break}var p=c[t],b=n(p,t);h=Z(B,m,d,null,p,b,t,f,a,e),m.items.set(b,h),d=h}l>0&&W(Q())}if(D)l===0&&v&&(_=X(()=>v(u)));else if(me()){var S=new Set,w=he;for(t=0;t<l;t+=1){p=c[t],b=n(p,t);var I=m.items.get(b)??T.get(b);I?se(I,p,t):(h=Z(null,m,null,null,p,b,t,f,a,e,!0),T.set(b,h)),S.add(b)}for(const[$,M]of m.items)S.has($)||w.skipped_effects.add(M.e);w.add_callback(o)}else o();A&&z(!0),y(s)}),D&&(u=B)}function Fe(r,a,e,n,f,v,u,m,g){var _=a.length,x=e.items,T=e.first,s=T,c,i=null,o=[],l=[],A,E,d,h;for(h=0;h<_;h+=1){if(A=a[h],E=m(A,h),d=x.get(E),d===void 0){var t=n.get(E);if(t!==void 0){n.delete(E),x.set(E,t);var p=i?i.next:s;C(e,i,t),C(e,t,p),U(t,p,f),i=t}else{var b=s?s.e.nodes_start:f;i=Z(b,e,i,i===null?e.first:i.next,A,E,h,v,u,g)}x.set(E,i),o=[],l=[],s=i.next;continue}if(se(d,A,h),(d.e.f&G)!==0&&re(d.e),d!==s){if(c!==void 0&&c.has(d)){if(o.length<l.length){var S=l[0],w;i=S.prev;var I=o[0],$=o[o.length-1];for(w=0;w<o.length;w+=1)U(o[w],S,f);for(w=0;w<l.length;w+=1)c.delete(l[w]);C(e,I.prev,$.next),C(e,i,I),C(e,$,S),s=S,i=$,h-=1,o=[],l=[]}else c.delete(d),U(d,s,f),C(e,d.prev,d.next),C(e,d,i===null?e.first:i.next),C(e,i,d),i=d;continue}for(o=[],l=[];s!==null&&s.k!==E;)(s.e.f&G)===0&&(c??(c=new Set)).add(s),l.push(s),s=s.next;if(s===null)continue;d=s}o.push(d),i=d,s=d.next}if(s!==null||c!==void 0){for(var M=c===void 0?[]:ae(c);s!==null;)(s.e.f&G)===0&&M.push(s),s=s.next;var V=M.length;if(V>0){var H=_===0?f:null;Le(e,M,H)}}r.first=e.first&&e.first.e,r.last=i&&i.e;for(var L of n.values())te(L.e);n.clear()}function se(r,a,e,n){ge(r.v,a),r.i=e}function Z(r,a,e,n,f,v,u,m,g,_,x){var T=(g&Ee)!==0,s=(g&we)===0,c=T?s?P(f,!1,!1):j(f):f,i=(g&xe)===0?u:j(u),o={i,v:c,k:v,a:null,e:null,prev:e,next:n};try{if(r===null){var l=document.createDocumentFragment();l.append(r=ee())}return o.e=X(()=>m(r,c,i,_),D),o.e.prev=e&&e.e,o.e.next=n&&n.e,e===null?x||(a.first=o):(e.next=o,e.e.next=o.e),n!==null&&(n.prev=o,n.e.prev=o.e),o}finally{}}function U(r,a,e){for(var n=r.next?r.next.e.nodes_start:e,f=a?a.e.nodes_start:e,v=r.e.nodes_start;v!==null&&v!==n;){var u=Te(v);f.before(v),v=u}}function C(r,a,e){a===null?r.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}const Je=()=>{const r=ke;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Pe={subscribe(r){return Je().page.subscribe(r)}},Ye="http://localhost:4000";async function qe(r,a){const e=new WebSocket(`ws://localhost:4000/run.Stream?id=${r}`);return e.onmessage=n=>{const f=JSON.parse(n.data);a(f)},e.onerror=n=>{console.error("WebSocket error:",n)},()=>e.close()}async function Ve(r){const a=await fetch(`${Ye}/run.Cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:r})});if(!a.ok)throw new Error("Failed to cancel run");return a.json()}async function We(r,a,e){try{await Ve(y(a)),alert("Run cancelled")}catch(n){k(e,n.message)}}var ze=Y('<div class="text-center">Loading events...</div>'),Ge=Y('<div class="p-4 bg-red-100 text-red-700 rounded mb-4"> </div>'),Ke=Y('<div class="mt-2"> </div>'),Ue=Y('<div class="p-4 border rounded-lg"><div class="font-semibold"> </div> <div class="text-sm text-gray-600"> </div> <!></div>'),Xe=Y('<div class="container mx-auto p-8"><div class="flex justify-between items-center mb-6"><h1 class="text-3xl font-bold"> </h1> <button class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Cancel Run</button></div> <!> <!> <div class="space-y-4"></div></div>');function ia(r,a){Ne(a,!1);const e=()=>Oe(Pe,"$page",n),[n,f]=De();let v=P(""),u=P([]),m=P(!0),g=P(""),_=null;ie(()=>{k(v,e().params.id),x()}),le(()=>{_&&_()});async function x(){try{_=await qe(y(v),t=>{k(u,[...y(u),t]),k(m,!1)})}catch(t){k(g,t.message),k(m,!1)}}Me();var T=Xe(),s=R(T),c=R(s),i=R(c);N(c);var o=O(c,2);o.__click=[We,v,g],N(s);var l=O(s,2);{var A=t=>{var p=ze();F(t,p)};K(l,t=>{y(m)&&t(A)})}var E=O(l,2);{var d=t=>{var p=Ge(),b=R(p,!0);N(p),q(()=>J(b,y(g))),F(t,p)};K(E,t=>{y(g)&&t(d)})}var h=O(E,2);Be(h,5,()=>y(u),He,(t,p)=>{var b=Ue(),S=R(b),w=R(S,!0);N(S);var I=O(S,2),$=R(I,!0);N(I);var M=O(I,2);{var V=H=>{var L=Ke(),ne=R(L,!0);N(L),q(()=>J(ne,y(p).message)),F(H,L)};K(M,H=>{y(p).message&&H(V)})}N(b),q(()=>{J(w,y(p).type),J($,y(p).timestamp)}),F(t,b)}),N(h),N(T),q(()=>J(i,`Run Timeline: ${y(v)??""}`)),F(r,T),Re(),f()}$e(["click"]);export{ia as component};
