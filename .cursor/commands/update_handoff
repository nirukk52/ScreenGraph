# Update Handoff Command (Thorough)

**Comprehensive handoff for production releases and major milestones (2-3 minutes).**

> üí° **Quick Alternative**: For regular work, use `@update_handoff_quick` (30 seconds, skips SKILLS.md/retros/extensive docs).

Use sequential thinking to create todos for the steps below:

## When to Use This Command

‚úÖ **Use Thorough Handoff** for:
- Production releases (PROC-001)
- Feature completions requiring retros
- Major architectural changes
- Skills/documentation updates
- End-of-milestone summaries

‚ùå **Use Quick Handoff** (`@update_handoff_quick`) for:
- Regular development work
- Bug fixes in progress
- Feature iterations
- Minor refactoring

---

## Deterministic Workflows (Choose one)
- Production Release Update (uses PROC-001 from `.cursor/procedures/PROCEDURES.md`)
- Regular Feature/Bug Handoff Update

## Step 1: Update Documentation Skills
Update all three `SKILLS.md` files with new capabilities/patterns learned.

## Step 2: Create Graphiti Memory Episodes
Create comprehensive memory episodes in the Graphiti MCP Memory System covering:
- **Rules**: New coding rules or conventions established
- **Facts**: Technical facts discovered (APIs, behaviors, bugs)
- **Procedures**: Step-by-step processes for common tasks
- **Preferences**: Architectural or implementation preferences

Group related information by `group_id` (e.g., feature ID, bug ID).

## Step 3: Update Handoff Documents
Update the appropriate handoff document (BACKEND_HANDOFF.md or FRONTEND_HANDOFF.md).

### 3A) Production Release Update (Deterministic Flow)
1. Load PROC-001 from `.cursor/procedures/PROCEDURES.md`
2. Confirm Preconditions (all must be checked):
   - [ ] `@test-default-run` passed
   - [ ] CI green on release PR
3. Update Handoff with ‚ÄúRelease Notes Template‚Äù from PROC-001:
   - Version/tag
   - Date
   - Backend changes
   - Frontend changes
   - Migrations
   - Smoke test status (+ link/screenshot)
4. Tag & Deploy summary:
   - Tag created/pushed (value)
   - Encore Cloud deploy status (link)
   - Vercel production deploy status (link)
5. Rollback plan (paste the PROC-001 rollback section verbatim)

### Handoff Template Structure:
```markdown
## Handoff #[NUMBER] - [DATE] - [BRIEF_TITLE]

- **What I am doing**: [Current task description]
- **What is pending**: 
  - [ ] Code implementation
  - [ ] Tests written/passing
  - [ ] Manual testing completed
  - [ ] Documentation updated
- **What I plan to do next**: [Next steps]
- **Modules I am touching**: 
  - `path/to/file1.ts`
  - `path/to/file2.ts`
- **Work status rating (out of 5)**: [0-5]
- **Graphiti episode IDs**: 
  - `[episode-uuid-1]` - [brief description]
  - `[episode-uuid-2]` - [brief description]
- **Related docs**: 
  - `path/to/doc1.md`
  - `path/to/doc2.md`
- **Notes for next agent**: [Context, gotchas, recommendations]
```

Add a new handoff section with an incremented number. Mark previous handoffs as completed if done.

## Step 4: Fallback for Graphiti Downtime
**IF Graphiti MCP is down**:
- Create `session_summary.md` in the appropriate feature/bug folder
- Include all rules, facts, procedures, preferences that would have gone into Graphiti
- Alert user with: üö®üî¥‚ö†Ô∏è DANGER: GRAPHITI MCP DOWN - CREATED FALLBACK SUMMARY üö®üî¥‚ö†Ô∏è

## Step 5: Create Retro Document
For completed features/bugs, create a retro document:
- Rating (out of 5)
- What went well
- What didn't go well
- Lessons learned

## Step 6: Commit and Push
- Stage all changes
- Create descriptive commit message using work context
- Push to remote
- Commit message should aid future debugging

## Step 7: Update Documentation Indexes
Ensure all `.md` files have updated table of contents/indexes.

---

## REQUIRED OUTPUT FORMAT

### If ‚ÄúProduction Release Update‚Äù was selected
Paste the normal output plus the following:
```
## ‚úÖ Production Release Verification
- Preconditions satisfied: [yes/no]
- Tag pushed: `<tag>`
- Encore deploy: <status/link>
- Vercel deploy: <status/link>
- Smoke test (prod): <pass/fail> (<link/screenshot>)
```

After completing all steps, produce this structured output for the user to paste into the next chat:

```markdown
# üîÑ Context Handoff - [FEATURE/BUG ID]

## üìã Quick Summary
[1-2 sentence summary of what was done]

## üìç Primary Handoff
- **Path**: `[path to BACKEND_HANDOFF.md or FRONTEND_HANDOFF.md]`
- **Handoff Section**: #[NUMBER]

## üß† Graphiti Memory Episodes
[If Graphiti was available]
- `[episode-uuid-1]` - [description]
- `[episode-uuid-2]` - [description]
- `[episode-uuid-3]` - [description]

[If Graphiti was DOWN]
üö® **Fallback Summary**: `[path/to/session_summary.md]`

## üìÇ Modified/Relevant Files
### Code Files
- `[path/to/file1.ts]`
- `[path/to/file2.ts]`

### Documentation
- `[path/to/doc1.md]`
- `[path/to/doc2.md]`

### Tests
- `[path/to/test1.test.ts]`

## üéØ Feature/Bug Tracking
- **Feature Request**: `[path/to/FR-XXX.md]` or **Bug**: `[path/to/BUG-XXX.md]`
- **Retro**: `[path/to/retro.md]`
- **Status**: `[path/to/status.md]`

## üîó Git
- **Branch**: `[branch-name]`
- **Latest Commit**: `[commit-hash]` - "[commit message]"

## ‚ö†Ô∏è Critical Notes
[Any gotchas, blockers, or important context for next agent]

## üìä Work Status
**Rating**: [X]/5
**Next Steps**: [Brief next action items]
```

Copy the above filled-in template and paste it into your next chat session to give the next agent full context.