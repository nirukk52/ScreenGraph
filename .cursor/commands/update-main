#!/usr/bin/env bash
# Update Main Command - Quick main.md note append
#
# Appends a note to main.md (< 5 seconds)

set -euo pipefail

ITEM_ID="${1:-}"
shift || true

if [[ -z "$ITEM_ID" ]]; then
  echo "Usage: update-main [ITEM-ID] [note]"
  echo "Example: update-main FR-015 'Added new endpoint for app info'"
  exit 1
fi

NOTE="$*"

if [[ -z "$NOTE" ]]; then
  echo "Error: Note cannot be empty"
  echo "Usage: update-main [ITEM-ID] [note]"
  exit 1
fi

# Find item directory
JIRA_DIR="jira"
PREFIX="${ITEM_ID%%-*}"

case "$PREFIX" in
  FR) CATEGORY="feature-requests" ;;
  BUG) CATEGORY="bugs" ;;
  TD) CATEGORY="tech-debt" ;;
  CHORE) CATEGORY="chores" ;;
  *)
    echo "Invalid item ID: $ITEM_ID"
    exit 1
    ;;
esac

ITEM_DIR="${JIRA_DIR}/${CATEGORY}/${ITEM_ID}"*
if [[ ! -d $ITEM_DIR ]]; then
  echo "Item not found: $ITEM_ID"
  exit 1
fi

MAIN_FILE="${ITEM_DIR}/main.md"

if [[ ! -f "$MAIN_FILE" ]]; then
  echo "main.md not found in $ITEM_DIR"
  exit 1
fi

# Append note to Notes section
DATE=$(date +%Y-%m-%d)
echo "" >> "$MAIN_FILE"
echo "**${DATE}:** ${NOTE}" >> "$MAIN_FILE"

echo "âœ“ Added note to main.md for $ITEM_ID"

