version: '3'

# Founder commands
# High-level orchestration, project management, workflows

tasks:
  # Server management
  servers:start:
    desc: "Start backend and frontend services via Turborepo harness"
    cmds:
      - echo "ğŸ§¹ Clearing standard ports (4000, 5173, 9400, 4723)..."
      - lsof -ti:4000 2>/dev/null | xargs kill -9 2>/dev/null || true
      - lsof -ti:5173 2>/dev/null | xargs kill -9 2>/dev/null || true
      - lsof -ti:9400 2>/dev/null | xargs kill -9 2>/dev/null || true
      - lsof -ti:4723 2>/dev/null | xargs kill -9 2>/dev/null || true
      - sleep 1
      - echo "ğŸš€ Starting services..."
      - bun run dev
    silent: false

  servers:stop:
    desc: "Stop all services"
    cmds:
      - echo "ğŸ›‘ Stopping Turborepo harness..."
      - pkill -f "turbo run dev" || true
      - pkill -f "encore run" || true
      - pkill -f "vite dev" || true
      - sleep 1
      - echo "âœ… Services stopped"
    silent: false

  servers:restart:
    desc: "Restart all services"
    cmds:
      - task: servers:stop
      - sleep 2
      - task: servers:start
    silent: false

  servers:status:
    desc: "Check service status"
    cmds:
      - node ../../../automation/scripts/env.mjs status
    silent: false

  # Rules and validation
  rules:check:
    desc: "Validate all founder rules"
    cmds:
      - node ../../../automation/scripts/check-founder-rules.mjs
    silent: false

  # Workflows
  workflows:regen-client:
    desc: "Regenerate frontend Encore client"
    cmds:
      - echo "ğŸ”„ Regenerating Encore client..."
      - cd ../../frontend && bun run gen
      - echo "âœ… Client regenerated"
    silent: false

  workflows:db-reset:
    desc: "Reset database (DESTRUCTIVE)"
    prompt: "This will delete all data. Continue?"
    cmds:
      - echo "âš ï¸  Resetting database..."
      - cd ../../backend && encore db reset
      - echo "âœ… Database reset complete"
    silent: false
