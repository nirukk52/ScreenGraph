#!/bin/bash

# Create Feature Request Folder
# Usage: When @-mentioned in Cursor, this command sets up a new feature request folder

# Get the feature ID and title from user input
read -p "Feature ID (e.g., FR-012): " FEATURE_ID
read -p "Short Title (kebab-case, e.g., api-rate-limiting): " TITLE

# Validate inputs
if [ -z "$FEATURE_ID" ] || [ -z "$TITLE" ]; then
    echo "‚ùå Error: Both Feature ID and Title are required"
    exit 1
fi

# Create folder name
FOLDER_NAME="${FEATURE_ID}-${TITLE}"
FOLDER_PATH="jira/feature-requests/${FOLDER_NAME}"

# Check if folder already exists
if [ -d "$FOLDER_PATH" ]; then
    echo "‚ùå Error: Folder ${FOLDER_PATH} already exists"
    exit 1
fi

# Create the folder
mkdir -p "$FOLDER_PATH"

# Copy templates and rename them
cp jira/feature-requests/TEMPLATE-main.md "${FOLDER_PATH}/${FEATURE_ID}-main.md"
cp jira/feature-requests/TEMPLATE-retro.md "${FOLDER_PATH}/${FEATURE_ID}-retro.md"
cp jira/feature-requests/TEMPLATE-status.md "${FOLDER_PATH}/${FEATURE_ID}-status.md"

# Replace placeholders in the main file
sed -i.bak "s/FR-XXX/${FEATURE_ID}/g" "${FOLDER_PATH}/${FEATURE_ID}-main.md"
sed -i.bak "s/\[Short Title\]/${TITLE}/g" "${FOLDER_PATH}/${FEATURE_ID}-main.md"
rm "${FOLDER_PATH}/${FEATURE_ID}-main.md.bak"

# Replace placeholders in retro
sed -i.bak "s/FR-XXX/${FEATURE_ID}/g" "${FOLDER_PATH}/${FEATURE_ID}-retro.md"
sed -i.bak "s/\[Short Title\]/${TITLE}/g" "${FOLDER_PATH}/${FEATURE_ID}-retro.md"
rm "${FOLDER_PATH}/${FEATURE_ID}-retro.md.bak"

# Replace placeholders in status
sed -i.bak "s/FR-XXX/${FEATURE_ID}/g" "${FOLDER_PATH}/${FEATURE_ID}-status.md"
sed -i.bak "s/\[Short Title\]/${TITLE}/g" "${FOLDER_PATH}/${FEATURE_ID}-status.md"
rm "${FOLDER_PATH}/${FEATURE_ID}-status.md.bak"

echo "‚úÖ Feature request folder created: ${FOLDER_PATH}"
echo ""
echo "üìÅ Created files:"
echo "   - ${FEATURE_ID}-main.md (main ticket)"
echo "   - ${FEATURE_ID}-retro.md (retrospective)"
echo "   - ${FEATURE_ID}-status.md (status report)"
echo ""
echo "üöÄ Next steps:"
echo "   1. Fill out ${FEATURE_ID}-main.md with feature details"
echo "   2. Update ${FEATURE_ID}-status.md as you work"
echo "   3. Complete ${FEATURE_ID}-retro.md when done"

