#!/bin/bash

# Free All Development Ports
# Usage: When @-mentioned in Cursor, this command frees all development ports

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Port categories
BACKEND_PORTS=(4000 4007)
FRONTEND_PORTS=(5173 5180)
DASHBOARD_PORTS=(9400 9407)
APPIUM_PORTS=(4723 4730)

# Function to free a single port
free_port() {
    local port=$1
    local pid=$(lsof -ti:$port 2>/dev/null)
    
    if [ -z "$pid" ]; then
        echo -e "${GREEN}âœ“${NC} Port ${port} is already free"
        return 0
    fi
    
    # Get process name for better logging
    local process_name=$(ps -p $pid -o comm= 2>/dev/null || echo "unknown")
    
    # Kill the process
    kill -9 $pid 2>/dev/null
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}âœ“${NC} Port ${port} freed (killed PID ${pid}, process: ${process_name})"
        return 0
    else
        echo -e "${RED}âœ—${NC} Failed to free port ${port}"
        return 1
    fi
}

# Function to free ports in a category
free_port_category() {
    local category_name=$1
    shift
    local ports=("$@")
    
    echo -e "\n${YELLOW}Freeing ${category_name} ports...${NC}"
    for port in "${ports[@]}"; do
        free_port $port
    done
}

# Main execution
echo -e "${YELLOW}ðŸ”Œ Freeing all development ports...${NC}\n"

free_port_category "Backend" "${BACKEND_PORTS[@]}"
free_port_category "Frontend" "${FRONTEND_PORTS[@]}"
free_port_category "Dashboard" "${DASHBOARD_PORTS[@]}"
free_port_category "Appium" "${APPIUM_PORTS[@]}"

echo -e "\n${GREEN}âœ… Port freeing complete!${NC}"

