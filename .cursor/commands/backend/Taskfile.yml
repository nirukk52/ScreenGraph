version: '3'

# Backend commands
# Backend-specific development tasks

vars:
  BACKEND_PORT:
    sh: node ../../../automation/scripts/env.mjs backend-port

tasks:
  dev:
    desc: "Start backend development server"
    cmds:
      - echo "ğŸ”§ Starting backend on port {{.BACKEND_PORT}}..."
      - cd ../../backend && encore run --port={{.BACKEND_PORT}}
    silent: false

  logs:
    desc: "View backend logs"
    cmds:
      - tail -f ../../backend.log
    silent: false

  health:
    desc: "Check backend health"
    cmds:
      - echo "â¤ï¸  Checking backend health..."
      - curl -f http://localhost:{{.BACKEND_PORT}}/health || echo "âš ï¸  Backend not responding"
    silent: false

  db:migrate:
    desc: "Run database migrations"
    cmds:
      - echo "ğŸ”„ Running database migrations..."
      - cd ../../backend && encore db migrate
      - echo "âœ… Migrations complete"
    silent: false

  db:reset:
    desc: "Reset database (DESTRUCTIVE)"
    prompt: "This will delete all data. Continue?"
    cmds:
      - echo "âš ï¸  Resetting database..."
      - cd ../../backend && encore db reset
      - echo "âœ… Database reset complete"
    silent: false

  db:shell:
    desc: "Open database shell"
    cmds:
      - cd ../../backend && encore db shell run --write
    silent: false

  test:
    desc: "Run backend tests"
    cmds:
      - echo "ğŸ§ª Running backend tests..."
      - cd ../../backend && encore test
    silent: false
