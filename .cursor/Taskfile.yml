version: '3'

# Root Taskfile for ScreenGraph
# Orchestrates all automation across the unified system

dotenv: ['../.env']

includes:
  # Domain-specific task namespaces
  shared:
    taskfile: ./commands/shared/Taskfile.yml
    dir: ./commands/shared
  
  backend:
    taskfile: ./commands/backend/Taskfile.yml
    dir: ./commands/backend
  
  frontend:
    taskfile: ./commands/frontend/Taskfile.yml
    dir: ./commands/frontend
  
  ops:
    taskfile: ./commands/ops/Taskfile.yml
    dir: ./commands/ops
  
  qa:
    taskfile: ./commands/qa/Taskfile.yml
    dir: ./commands/qa

vars:
  # Resolved from automation/scripts/env.mjs
  BACKEND_PORT:
    sh: node ../automation/scripts/env.mjs backend-port
  
  FRONTEND_PORT:
    sh: node ../automation/scripts/env.mjs frontend-port
  
tasks:
  default:
    desc: "List all available tasks"
    cmds:
      - task --list-all
    silent: true

  help:
    desc: "Show help and common commands"
    cmds:
      - echo "ScreenGraph Unified Automation System"
      - echo ""
      - echo "Common commands:"
      - echo "  task ops:servers:start        - Start backend + frontend"
      - echo "  task ops:servers:stop         - Stop all services"
      - echo "  task ops:servers:status       - Check service status"
      - echo "  task qa:smoke:backend         - Run backend smoke tests"
      - echo "  task qa:smoke:frontend        - Run frontend smoke tests"
      - echo "  task qa:rules:check           - Validate founder rules"
      - echo "  task backend:db:status        - Show database cluster info"
      - echo ""
      - echo "Run task --list-all for all available tasks"
    silent: true

